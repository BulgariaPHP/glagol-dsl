module Test::Compiler::Laravel::Config::Cache

import Compiler::Laravel::Config::Cache;
import Syntax::Abstract::Glagol;
import Syntax::Abstract::PHP;
import Compiler::PHP::Compiler;
import lang::json::ast::JSON;

test bool shouldCreateLaravelCacheConfig() =
    createCacheConfig() == toCode(phpScript([phpReturn(phpSomeExpr(phpArray([
            phpArrayElement(
              phpSomeExpr(phpScalar(phpString("default"))),
              phpCall(
                phpName(phpName("env")),
                [
                  phpActualParameter(
                    phpScalar(phpString("CACHE_DRIVER")),
                    false),
                  phpActualParameter(
                    phpScalar(phpString("file")),
                    false)
                ]),
              false),
            phpArrayElement(
              phpSomeExpr(phpScalar(phpString("stores"))),
              phpArray([
                  phpArrayElement(
                    phpSomeExpr(phpScalar(phpString("apc"))),
                    phpArray([phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("driver"))),
                          phpScalar(phpString("apc")),
                          false)]),
                    false),
                  phpArrayElement(
                    phpSomeExpr(phpScalar(phpString("memcached"))),
                    phpArray([
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("persistent_id"))),
                          phpCall(
                            phpName(phpName("env")),
                            [phpActualParameter(
                                phpScalar(phpString("MEMCACHED_PERSISTENT_ID")),
                                false)]),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("sasl"))),
                          phpArray([
                              phpArrayElement(
                                phpNoExpr(),
                                phpCall(
                                  phpName(phpName("env")),
                                  [phpActualParameter(
                                      phpScalar(phpString("MEMCACHED_USERNAME")),
                                      false)]),
                                false),
                              phpArrayElement(
                                phpNoExpr(),
                                phpCall(
                                  phpName(phpName("env")),
                                  [phpActualParameter(
                                      phpScalar(phpString("MEMCACHED_PASSWORD")),
                                      false)]),
                                false)
                            ]),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("driver"))),
                          phpScalar(phpString("memcached")),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("servers"))),
                          phpArray([phpArrayElement(
                                phpNoExpr(),
                                phpArray([
                                    phpArrayElement(
                                      phpSomeExpr(phpScalar(phpString("port"))),
                                      phpCall(
                                        phpName(phpName("env")),
                                        [
                                          phpActualParameter(
                                            phpScalar(phpString("MEMCACHED_PORT")),
                                            false),
                                          phpActualParameter(
                                            phpScalar(phpString("11211")),
                                            false)
                                        ]),
                                      false),
                                    phpArrayElement(
                                      phpSomeExpr(phpScalar(phpString("host"))),
                                      phpCall(
                                        phpName(phpName("env")),
                                        [
                                          phpActualParameter(
                                            phpScalar(phpString("MEMCACHED_HOST")),
                                            false),
                                          phpActualParameter(
                                            phpScalar(phpString("127.0.0.1")),
                                            false)
                                        ]),
                                      false),
                                    phpArrayElement(
                                      phpSomeExpr(phpScalar(phpString("weight"))),
                                      phpScalar(phpInteger(100)),
                                      false)
                                  ]),
                                false)]),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("options"))),
                          phpArray([]),
                          false)
                      ]),
                    false),
                  phpArrayElement(
                    phpSomeExpr(phpScalar(phpString("array"))),
                    phpArray([phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("driver"))),
                          phpScalar(phpString("array")),
                          false)]),
                    false),
                  phpArrayElement(
                    phpSomeExpr(phpScalar(phpString("file"))),
                    phpArray([
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("path"))),
                          phpCall(
                            phpName(phpName("storage_path")),
                            [phpActualParameter(
                                phpScalar(phpString("framework/cache")),
                                false)]),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("driver"))),
                          phpScalar(phpString("file")),
                          false)
                      ]),
                    false),
                  phpArrayElement(
                    phpSomeExpr(phpScalar(phpString("database"))),
                    phpArray([
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("driver"))),
                          phpScalar(phpString("database")),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("table"))),
                          phpScalar(phpString("cache")),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("connection"))),
                          phpScalar(phpNull()),
                          false)
                      ]),
                    false),
                  phpArrayElement(
                    phpSomeExpr(phpScalar(phpString("redis"))),
                    phpArray([
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("driver"))),
                          phpScalar(phpString("redis")),
                          false),
                        phpArrayElement(
                          phpSomeExpr(phpScalar(phpString("connection"))),
                          phpScalar(phpString("default")),
                          false)
                      ]),
                    false)
                ]),
              false)
          ])))]));
